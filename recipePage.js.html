<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>recipePage.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="RecipeCard.html">RecipeCard</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#addFavoriteRecipe">addFavoriteRecipe</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#bindRC">bindRC</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#createRecipeCards">createRecipeCards</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#createRecipeObject">createRecipeObject</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#evaluateFraction">evaluateFraction</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#extractIngredients">extractIngredients</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#extractNutrition">extractNutrition</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#extractSteps">extractSteps</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#fetchRecipes">fetchRecipes</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#generateUniqueID">generateUniqueID</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getDeletedRecipes">getDeletedRecipes</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getFavoriteRecipes">getFavoriteRecipes</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getLocalStorageRecipes">getLocalStorageRecipes</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getNRandomRecipes">getNRandomRecipes</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getRandomNumbers">getRandomNumbers</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getRecipesByType">getRecipesByType</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getRecipesCount">getRecipesCount</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#ingredientUpdates">ingredientUpdates</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#init">init</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#loadUserData">loadUserData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#nutritionUpdates">nutritionUpdates</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#populateListElements">populateListElements</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#populateLists">populateLists</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#populateRecipes">populateRecipes</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#removeDeletedRecipes">removeDeletedRecipes</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#removeFavoriteRecipe">removeFavoriteRecipe</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#removeRecipe">removeRecipe</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#removeSummaryLinks">removeSummaryLinks</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#searchLocalRecipes">searchLocalRecipes</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#setIntolerances">setIntolerances</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#setLocalStorageItem">setLocalStorageItem</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#setMaxTime">setMaxTime</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#setUpBtns">setUpBtns</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#setUpRefreshButton">setUpRefreshButton</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#updateLatestSearch">updateLatestSearch</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#updateUserData">updateUserData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#webScrapper">webScrapper</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">recipePage.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import * as LSHandler from './API/localStorageHandler.js'

const id = window.location.hash.slice(1)
const ingredientElementArr = []
const nutritionElementArr = []
let defaultServing
let defaultIngredients
let defaultNutrition

window.addEventListener('DOMContentLoaded', init)

/**
 * The Initialization of the recipe page and the elements inside the recipe
 */
function init () {
  const eTitle = document.getElementById('recipe-title') // done
  const eImage = document.getElementById('recipe-image') // done
  // const eTags = document.getElementById('recipe-tags') // don't have
  const eTime = document.getElementById('recipe-time') // done
  const eServes = document.getElementById('recipe-serves') // done
  const eDescription = document.getElementById('recipe-description') // don't have

  // Preferably, we would have a function from the API utils that gets recipe data for us
  let data = localStorage.getItem(id) // get the recipe data (here it's a string)
  if (!data) { return }
  data = JSON.parse(data) // parse the string rep of the object to create an object
  document.querySelector('head > title').innerText = data.title

  // Set data values
  eTitle.innerText = data.title
  eImage.setAttribute('src', data.image)
  eTime.innerText = data.readyInMinutes
  defaultIngredients = data.ingredients
  defaultNutrition = data.nutrition

  eServes.value = data.servingSize
  defaultServing = data.servingSize
  eDescription.innerHTML = data.summary ? data.summary : ''

  populateListElements(data.ingredients, 'recipe-ingredients-list')
  populateListElements(data.steps, 'recipe-steps-list')
  populateListElements(data.nutrition, 'recipe-nutrition-list')
  setUpBtns()
  eServes.addEventListener('change', (event) => {
    ingredientUpdates(eServes.value)
    nutritionUpdates(eServes.value)
  })
}

/**
 * updates values in nutrition according to servingSize
 * @param {*} servingSize
 */
function nutritionUpdates (servingSize) {
  if (nutritionElementArr.length &lt;= 0) {
    return
  }

  const ratio = servingSize / defaultServing

  for (let index = 0; index &lt; nutritionElementArr.length; index++) {
    const element = nutritionElementArr[index]

    const nutrString = defaultNutrition[index]
    if (ratio === 1) {
      element.innerText = defaultNutrition[index]
      continue
    }

    const match = nutrString.match(/[+-]?([0-9]*[.])?[0-9]+/)

    if (!match) {
      continue
    }

    const length = match[0].length
    const matchIndex = match.index
    const endIndex = (matchIndex + length)
    let amount = parseFloat(match[0])

    amount = (amount * ratio).toFixed(2)
    element.innerText = nutrString.substring(0, matchIndex) + ': ' + amount + ' ' + nutrString.substring(endIndex)
  }
}

/**
 * updates values in ingredients according to servingSize
 * @param {*} servingSize
 */
function ingredientUpdates (servingSize) {
  if (ingredientElementArr.length &lt;= 0) {
    return
  }

  const ratio = servingSize / defaultServing

  const fractionPattern = /([0-9]*\/)?[0-9]+/

  for (let i = 0; i &lt; ingredientElementArr.length; i++) {
    const element = ingredientElementArr[i]
    const ingString = defaultIngredients[i]
    if (ratio === 1) {
      element.innerText = ingString
      continue
    }

    const match = ingString.match(fractionPattern)

    if (!match || match.index > 0) {
      element.innerText = ratio + ' ' + ingString
      continue
    }

    if (match.index === 0) {
      let amount = match[0].includes('/') ? evaluateFraction(match[0]) : parseFloat(match[0]).toFixed(2)
      amount = amount * ratio
      const length = match[0].length
      element.innerText = amount + ingString.substring(length)
    }
  }
}

/**
 * evaluate Fraction number in string format
 * @param {*} frac
 * @returns {number}
 */
function evaluateFraction (frac) {
  const strArr = frac.split('/')
  return parseFloat(strArr[0]) / parseFloat(strArr[1]).toFixed(2)
}

/**
 * creates list elements for recipe page
 * @param {*} dataArr
 * @param {*} listID
 */
function populateListElements (dataArr, listID) {
  const list = document.getElementById(listID)
  dataArr.forEach(data => {
    const item = document.createElement('li')
    item.innerText = data
    if (listID === 'recipe-ingredients-list') { ingredientElementArr.push(item) }
    if (listID === 'recipe-nutrition-list') { nutritionElementArr.push(item) }
    list.appendChild(item)
  })
}

/**
 * set up buttons for recipe page
 */
function setUpBtns () {
  const favoriteBtn = document.getElementById('favorite')
  let favArr = LSHandler.getFavoriteRecipes()
  if (favArr &amp;&amp; favArr.includes(id)) {
    favoriteBtn.classList.add('liked')
  }

  favoriteBtn.addEventListener('click', e => {
    favArr = LSHandler.getFavoriteRecipes()
    if (favArr &amp;&amp; favArr.includes(id)) {
      LSHandler.removeFavoriteRecipe(id)
    } else {
      LSHandler.addFavoriteRecipe(id)
    }
  })

  const deleteBtn = document.getElementById('delete')
  let deletedRecipes = LSHandler.getDeletedRecipes()
  deleteBtn.addEventListener('click', e => {
    if (confirm('Are you sure you want to delete this recipe?')) {
      LSHandler.removeRecipe(id)

      deletedRecipes = LSHandler.getDeletedRecipes()
      deletedRecipes.push(parseInt(id))
      LSHandler.updateUserData('deletedRecipes', deletedRecipes)

      window.location.href = '/index.html'
    }
  })

  const searchBtn = document.getElementById('search-icon')
  searchBtn.addEventListener('click', e => {
    e.preventDefault()
    const searchQuery = document.getElementById('search-bar').value
    LSHandler.searchLocalRecipes(searchQuery).then(() => {
      window.location.href = '/searchpage.html'
    })
  })
}

// changing the color
document.querySelector('#favorite').addEventListener('click', (e) => {
  e.currentTarget.classList.toggle('liked')
})

document.getElementById('edit-recipe').addEventListener('click', e => {
  window.location.href = '/createRecipe.html#' + id
})
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a> on Fri Dec 10 2021 01:47:10 GMT+0000 (Coordinated Universal Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
