<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>createRecipe.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="RecipeCard.html">RecipeCard</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#addFavoriteRecipe">addFavoriteRecipe</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#bindRC">bindRC</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#createRecipeCards">createRecipeCards</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#createRecipeObject">createRecipeObject</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#evaluateFraction">evaluateFraction</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#extractIngredients">extractIngredients</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#extractNutrition">extractNutrition</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#extractSteps">extractSteps</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#fetchRecipes">fetchRecipes</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#generateUniqueID">generateUniqueID</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getDeletedRecipes">getDeletedRecipes</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getFavoriteRecipes">getFavoriteRecipes</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getLocalStorageRecipes">getLocalStorageRecipes</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getNRandomRecipes">getNRandomRecipes</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getRandomNumbers">getRandomNumbers</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getRecipesByType">getRecipesByType</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getRecipesCount">getRecipesCount</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#ingredientUpdates">ingredientUpdates</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#init">init</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#loadUserData">loadUserData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#nutritionUpdates">nutritionUpdates</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#populateListElements">populateListElements</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#populateLists">populateLists</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#populateRecipes">populateRecipes</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#removeDeletedRecipes">removeDeletedRecipes</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#removeFavoriteRecipe">removeFavoriteRecipe</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#removeRecipe">removeRecipe</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#removeSummaryLinks">removeSummaryLinks</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#searchLocalRecipes">searchLocalRecipes</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#setIntolerances">setIntolerances</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#setLocalStorageItem">setLocalStorageItem</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#setMaxTime">setMaxTime</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#setUpBtns">setUpBtns</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#setUpRefreshButton">setUpRefreshButton</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#updateLatestSearch">updateLatestSearch</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#updateUserData">updateUserData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#webScrapper">webScrapper</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">createRecipe.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import * as LSHandler from './API/localStorageHandler.js'
import { generateUniqueID } from './API/utilityFunctions.js'

const recipeImg = document.getElementById('recipe-img')
let compressedImg // store base64 compressed image (string)

const addIng = document.getElementById('add-ing')
const addStep = document.getElementById('add-step')
const addNutrition = document.getElementById('add-nutrition')

const createRecipe = document.getElementById('create-btn')
const cancelBtn = document.getElementById('cancel-btn')

window.addEventListener('DOMContentLoaded', e => {
  if (window.location.hash) {
    const id = window.location.hash.slice(1)
    const recipeData = JSON.parse(localStorage.getItem(id))
    populateRecipeForm(recipeData)
    createRecipe.innerText = 'Update'
  }
})

recipeImg.addEventListener('change', (e) => {
  const input = e.target.files[0]
  const previewImg = document.getElementById('preview-img')
  const fileReader = new FileReader()

  fileReader.addEventListener('load', (event) => {
    previewImg.src = event.target.result
    previewImg.classList.remove('no-preview')

    // resizing and compressing input image using &lt;canvas>
    previewImg.addEventListener('load', (imgData) => {
      const canvas = document.createElement('canvas')
      const FIXED_WIDTH = 312 * 2
      const FIXED_HEIGHT = 231 * 2

      canvas.width = FIXED_WIDTH
      canvas.height = FIXED_HEIGHT

      const ctx = canvas.getContext('2d')
      ctx.drawImage(imgData.target, 0, 0, canvas.width, canvas.height)
      const imgEncoded = ctx.canvas.toDataURL(imgData, 'image/jpeg')
      compressedImg = imgEncoded
    })
  })

  if (input) {
    fileReader.readAsDataURL(input)
  }
})

addIng.addEventListener('click', e => {
  addContainer('ingredient-container', 'ingredients', 'ing-name', '2', '50')
})

addStep.addEventListener('click', e => {
  addContainer('steps-container', 'steps', 'step-name', '3', '50')
})

addNutrition.addEventListener('click', e => {
  addContainer('nutrition-container', 'nutrition', 'nutr-name', '2', '30')
})

function addContainer (containerClass, textAreaName, textAreaClass, rows, cols) {
  const elementContainer = document.querySelectorAll('.' + containerClass)
  const elementContainerLength = elementContainer.length
  const fieldSet = document.createElement('fieldset')
  const fieldSetLabel = document.createElement('label')
  const fieldTextArea = document.createElement('textarea')
  const deleteBtn = document.createElement('button')
  const removeIcon = document.createElement('img')

  deleteBtn.type = 'button'
  deleteBtn.classList.add('remove-btn')
  removeIcon.src = './source/image/icons8-delete.svg'
  removeIcon.style.width = '30px'
  deleteBtn.appendChild(removeIcon)
  deleteBtn.addEventListener('click', removeItem)

  fieldSetLabel.innerText = '•'
  fieldTextArea.name = textAreaName

  fieldTextArea.classList.add(textAreaClass)
  // fieldTextArea.type = 'text';
  fieldTextArea.cols = cols
  fieldTextArea.rows = rows

  fieldSet.classList.add(containerClass)
  fieldSet.appendChild(fieldSetLabel)
  fieldSet.appendChild(fieldTextArea)
  fieldSet.appendChild(deleteBtn)

  elementContainer[elementContainerLength - 1].after(fieldSet)
}

function removeItem (e) {
  const i = e.path[0].tagName === 'IMG' ? 0 : 1
  const parentContainer = e.path[3 - i]
  const fieldSet = e.path[2 - i]
  fieldSet.querySelector('.remove-btn').removeEventListener('click', removeItem)
  parentContainer.removeChild(fieldSet)
}

createRecipe.addEventListener('click', e => {
  e.preventDefault()
  const formRes = {
    id: '',
    image: '',
    favorite: true,
    readyInMinutes: 0,
    servingSize: 1,
    title: '',
    summary: '',
    ingredients: [],
    ingredientSearch: {},
    steps: [],
    nutrition: [],
    dishTypes: []
  }
  const formData = document.getElementById('recipe-form')
  const formObj = new FormData(formData)
  const formKeys = Array.from(formObj.keys())
  const hash = window.location.hash
  const title = formObj.get('title').toString().replace(/\s+/g, ' ')

  if (hash) {
    const currRecipe = JSON.parse(localStorage.getItem(hash.slice(1)))
    if (hash.slice(1, 4) === 'ucr') {
      if (title !== currRecipe.title) {
        localStorage.removeItem(hash.slice(1))
      }
      formRes.id = title.replaceAll(' ', '')
      formRes.id = generateUniqueID(formRes.id)
    } else {
      formRes.id = currRecipe.id
      formRes.image = currRecipe.image
      formRes.favorite = currRecipe.favorite
    }
  } else {
    formRes.id = title.replaceAll(' ', '')
    formRes.id = generateUniqueID(formRes.id)
    LSHandler.addFavoriteRecipe(formRes.id)
  }

  formKeys.forEach(key => {
    const res = formObj.getAll(key)

    if (key === 'steps' || key === 'nutrition' || key === 'ingredients') {
      formRes[key] = formObj.getAll(key)
    } else if (key === 'recipeDesc') {
      formRes.summary = res[0]
    } else if (key === 'image') {
      const defaultImg = '../../admin/branding/logo3_231x231.jpg'
      formRes[key] = (compressedImg || defaultImg)
    } else {
      formRes[key] = res[0]
    }
  })

  title.toLowerCase().split(' ').forEach(word => {
    formRes.ingredientSearch[word] = 1
  })
  formRes.ingredients.forEach(ingredient => {
    ingredient.split(' ').forEach(word => {
      formRes.ingredientSearch[word] = 1
    })
  })

  LSHandler.setLocalStorageItem(formRes.id, formRes)
  window.location.href = '/recipePage.html#' + formRes.id
})

cancelBtn.addEventListener('click', e => {
  if (confirm("Are you sure you want exit?\nYour changes won't be saved.")) {
    window.location.href = '/index.html'
  }
})

function populateRecipeForm (recipeData) {
  document.getElementById('recipe-name').value = recipeData.title
  document.getElementById('recipe-time').value = recipeData.readyInMinutes
  document.getElementById('recipe-desc').value = recipeData.summary
  document.getElementById('recipe-serve').value = recipeData.servingSize

  // Image fill-in
  const previewImg = document.getElementById('preview-img')
  const defaultImg = '../../admin/branding/logo3_231x231.jpg'

  if (recipeData.image === defaultImg) {
    compressedImg = defaultImg
  } else {
    previewImg.src = recipeData.image
    compressedImg = recipeData.image
    previewImg.classList.remove('no-preview')
  }

  populateLists(recipeData)
}

/**
 * responsible for populating the list field like ingredirents, steps, and nutritions
 * @param {*} recipeData - json data of recipe
 */
function populateLists (recipeData) {
  // Ingredients fill-in
  const numIng = recipeData.ingredients.length
  const ingInputs = document.getElementsByClassName('ing-name')
  for (let i = 0; i &lt; numIng - 1; i++) {
    addIng.click()
    ingInputs[i].value = recipeData.ingredients[i]
  }
  ingInputs[numIng - 1].value = recipeData.ingredients[numIng - 1]

  // Steps fill-in
  const numSteps = recipeData.steps.length - 1
  const stepInputs = document.getElementsByClassName('step-name')
  for (let i = 0; i &lt; numSteps - 1; i++) {
    addStep.click()
    stepInputs[i].value = recipeData.steps[i]
  }
  stepInputs[numSteps - 1].value = recipeData.steps[numSteps - 1]

  // Nutrition fill-in
  const numNutrients = recipeData.nutrition.length
  const nutritionInputs = document.getElementsByClassName('nutr-name')
  for (let i = 0; i &lt; numNutrients - 1; i++) {
    addNutrition.click()
    nutritionInputs[i].value = recipeData.nutrition[i]
  }
  nutritionInputs[numNutrients - 1].value = recipeData.nutrition[numNutrients - 1]
}
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a> on Thu Dec 09 2021 23:20:02 GMT+0000 (Coordinated Universal Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
